# è½»é‡çº§å¾®å‰ç«¯æ¡†æ¶

åŸºäº iframe + postMessage çš„å¾®å‰ç«¯è§£å†³æ–¹æ¡ˆï¼Œå®Œå…¨é¿å…è·¨åŸŸé—®é¢˜ã€‚

## ğŸš€ ç‰¹æ€§

- âœ… **é›¶è·¨åŸŸé—®é¢˜** - åŸºäº iframe å®Œå…¨éš”ç¦»
- âœ… **è½»é‡çº§** - æ ¸å¿ƒä»£ç ä¸åˆ° 200 è¡Œ
- âœ… **æ¡†æ¶æ— å…³** - æ”¯æŒä»»ä½•å‰ç«¯æ¡†æ¶
- âœ… **é€šä¿¡æœºåˆ¶** - åŸºäº postMessage çš„åŒå‘é€šä¿¡
- âœ… **è·¯ç”±åŒæ­¥** - æ”¯æŒæµè§ˆå™¨å‰è¿›åé€€
- âœ… **å…¨å±€çŠ¶æ€** - è·¨åº”ç”¨çŠ¶æ€å…±äº«
- âœ… **ç”Ÿå‘½å‘¨æœŸ** - å®Œæ•´çš„åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ main/                    # ä¸»åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ micro-frontend.js    # å¾®å‰ç«¯æ¡†æ¶æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ main.js              # åº”ç”¨å…¥å£
â”‚   â”‚   â””â”€â”€ App.vue              # ä¸»ç»„ä»¶
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.js
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ shared/                  # å…±äº«èµ„æº
â”‚   â””â”€â”€ micro-app-sdk.js     # å­åº”ç”¨ SDK
â”œâ”€â”€ react-app/               # React å­åº”ç”¨
â”œâ”€â”€ vue-app/                 # Vue å­åº”ç”¨
â”œâ”€â”€ package.json             # å·¥ä½œç©ºé—´é…ç½®
â””â”€â”€ start-all.js             # å¯åŠ¨è„šæœ¬
```

## ğŸ›  ä½¿ç”¨æ–¹æ³•

### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£…æ‰€æœ‰åº”ç”¨çš„ä¾èµ–
npm run install:all
```

### 2. å¯åŠ¨æ‰€æœ‰åº”ç”¨

```bash
npm run start:all
```

### 3. å•ç‹¬å¯åŠ¨

```bash
# ä¸»åº”ç”¨ (å¼€å‘æ¨¡å¼)
npm run dev:main

# React å­åº”ç”¨
npm run start:react

# Vue å­åº”ç”¨
npm run start:vue
```

### 3. è®¿é—®åº”ç”¨

- ä¸»åº”ç”¨: http://localhost:3000
- React åº”ç”¨: http://localhost:3001
- Vue åº”ç”¨: http://localhost:3002

## ğŸ”§ API æ–‡æ¡£

### ä¸»åº”ç”¨ API

```javascript
import microFrontend from "./micro-frontend.js";

// æ³¨å†Œåº”ç”¨
microFrontend.registerApp({
  name: "my-app",
  url: "http://localhost:3001",
  container: "#app-container",
  route: "/my-app",
});

// åŠ è½½åº”ç”¨
await microFrontend.loadApp("my-app");

// ç›‘å¬äº‹ä»¶
microFrontend.on("app-loaded", (event) => {
  console.log("åº”ç”¨åŠ è½½å®Œæˆ", event.detail.name);
});
```

### å­åº”ç”¨ SDK

```javascript
import microAppSDK from "./micro-app-sdk.js";

// ç›‘å¬ç”Ÿå‘½å‘¨æœŸ
microAppSDK.on("mount", () => {
  console.log("åº”ç”¨æŒ‚è½½");
});

microAppSDK.on("unmount", () => {
  console.log("åº”ç”¨å¸è½½");
});

// è·¯ç”±å˜åŒ–
microAppSDK.setRoute("/user/123");

// å…¨å±€çŠ¶æ€
microAppSDK.setGlobalState({ user: "John" });
```

## ğŸ”„ é€šä¿¡æœºåˆ¶

### ä¸»åº”ç”¨ â†’ å­åº”ç”¨

```javascript
// ä¸»åº”ç”¨å‘é€æ¶ˆæ¯
iframe.contentWindow.postMessage(
  {
    type: "mount",
    data: { route: "/user" },
  },
  "*"
);
```

### å­åº”ç”¨ â†’ ä¸»åº”ç”¨

```javascript
// å­åº”ç”¨å‘é€æ¶ˆæ¯
window.parent.postMessage(
  {
    type: "route-change",
    data: { route: "/user/123" },
  },
  "*"
);
```

## ğŸ“‹ æ¶ˆæ¯ç±»å‹

| ç±»å‹                  | æ–¹å‘    | è¯´æ˜           |
| --------------------- | ------- | -------------- |
| `init`                | ä¸» â†’ å­ | åˆå§‹åŒ–å­åº”ç”¨   |
| `mount`               | ä¸» â†’ å­ | æŒ‚è½½å­åº”ç”¨     |
| `unmount`             | ä¸» â†’ å­ | å¸è½½å­åº”ç”¨     |
| `ready`               | å­ â†’ ä¸» | å­åº”ç”¨å‡†å¤‡å°±ç»ª |
| `route-change`        | å­ â†’ ä¸» | è·¯ç”±å˜åŒ–       |
| `global-state-change` | åŒå‘    | å…¨å±€çŠ¶æ€å˜åŒ–   |

## ğŸ¯ ä¼˜åŠ¿å¯¹æ¯”

| ç‰¹æ€§     | iframe æ–¹æ¡ˆ | qiankun   | single-spa |
| -------- | ----------- | --------- | ---------- |
| è·¨åŸŸé—®é¢˜ | âœ… æ—        | âŒ å¤æ‚   | âŒ å¤æ‚    |
| æ ·å¼éš”ç¦» | âœ… å®Œå…¨éš”ç¦» | âš ï¸ éœ€é…ç½® | âŒ éœ€å¤„ç†  |
| JS éš”ç¦»  | âœ… å®Œå…¨éš”ç¦» | âœ… æ²™ç®±   | âŒ éœ€å¤„ç†  |
| å­¦ä¹ æˆæœ¬ | âœ… ä½       | âš ï¸ ä¸­ç­‰   | âŒ é«˜      |
| æ€§èƒ½     | âš ï¸ ä¸­ç­‰     | âœ… å¥½     | âœ… å¥½      |
| SEO      | âŒ ä¸å‹å¥½   | âœ… æ”¯æŒ   | âœ… æ”¯æŒ    |

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **æ€§èƒ½è€ƒè™‘** - iframe ä¼šå¢åŠ å†…å­˜å ç”¨
2. **SEO é™åˆ¶** - æœç´¢å¼•æ“æ— æ³•ç´¢å¼• iframe å†…å®¹
3. **ç§»åŠ¨ç«¯é€‚é…** - éœ€è¦ç‰¹åˆ«å¤„ç†ç§»åŠ¨ç«¯æ»šåŠ¨
4. **å®‰å…¨æ€§** - æ³¨æ„ postMessage çš„æ¥æºéªŒè¯

## ğŸ”® æ‰©å±•åŠŸèƒ½

- [ ] åº”ç”¨é¢„åŠ è½½
- [ ] é”™è¯¯è¾¹ç•Œå¤„ç†
- [ ] æ€§èƒ½ç›‘æ§
- [ ] åº”ç”¨ç¼“å­˜
- [ ] ä¸»é¢˜åˆ‡æ¢
- [ ] å›½é™…åŒ–æ”¯æŒ
